<meta charset="utf-8">

<script src="underscore-min.js"></script>
<script src="vue-original-server-bundle.js"></script>
<script src="vue-repeat1-server-bundle.js"></script>
<script src="vue-server-bundle.js"></script>
<script src="benchmark.js"></script>
<script src="source.js"></script>

<script>

    var custom = {
        extend: function() {
            return Array.prototype.reduce.call(arguments, function(previousValue, currentValue) {
                for (var item in currentValue) {
                    previousValue[item] = currentValue[item];
                }

                return previousValue;
            });
        }
    };





    var cloneFull = function(obj) {
        function clone(obj) {
            var copy;

            // Handle the 3 simple types, and null or undefined
            if (null == obj || "object" != typeof obj) return obj;

            // Handle Date
            if (obj instanceof Date) {
                copy = new Date();
                copy.setTime(obj.getTime());
                return copy;
            }

            // Handle Array
            if (obj instanceof Array) {
                copy = [];
                for (var i = 0, len = obj.length; i < len; i++) {
                    copy[i] = clone(obj[i]);
                }
                return copy;
            }

            // Handle Object
            if (obj instanceof Object) {
                copy = {};
                for (var attr in obj) {
                    if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);
                }
                return copy;
            }

            throw new Error("Unable to copy obj! Its type isn't supported.");
        }


        return clone(obj);
    }
</script>



<script>

    var prepareTemplates = function(data, compiler) {
        data.template = compiler(data.template);
        
        _.each(data.partials, function(item, key) {
            data.partials[key] = compiler(item);
        });

        _.each(data.components, function(item) {
            item.template = compiler(item.template);
        });
    }
    

    var OriginalVueCompile = window.OriginalVueServer.compiler;
    var OriginalVueRender = window.OriginalVueServer.renderer;
    var OriginalVueData = cloneFull(data);
    prepareTemplates(OriginalVueData, OriginalVueCompile);

    var VueCompileRepeat1 = window.VueServerRepeat1.compiler;
    var VueRenderRepeat1 = window.VueServerRepeat1.renderer;
    var VueDataRepeat1 = cloneFull(data);
    prepareTemplates(VueDataRepeat1, VueCompileRepeat1);

    var VueCompile = window.VueServer.compiler;
    var VueRender = window.VueServer.renderer;
    var VueData = cloneFull(data);
    prepareTemplates(VueData, VueCompile);



    // Benchmark.options.minSamples = 120;
    var suite = new Benchmark.Suite;


    var testing = {
        ok: true,
        wtf: true,
        prepareData: true
    }
    // add tests
    suite
    .add('Original VueRender', {
        defer: true,
        fn: function(deferred) {
            new OriginalVueRender(OriginalVueData).render();
            deferred.resolve();
        }
    })
    .add('VueRender Old', {
        defer: true,
        fn: function(deferred) {
            var Vue = new VueRenderRepeat1();

            // Vue.config.silent = true;

            var vm = new Vue(VueDataRepeat1);
                
            vm.$on('vueServer.htmlReady', function(html) {
                deferred.resolve();
            });

            vm.$emit('_vueServer.renderHtml');
        }
    })
    .add('VueRender', {
        defer: true,
        fn: function(deferred) {
            var Vue = new VueRender();

            // Vue.config.silent = true;

            var vm = new Vue(VueData);
                
            vm.$on('vueServer.htmlReady', function(html) {
                deferred.resolve();
            });
        }
    })
    // .add('_.extend', function() {
    //     _.extend({}, {
    //         tap: 1,
    //         fap: 1,
    //         map: 1,
    //         gap: 1,
    //         cap: 1,
    //         sap: 1,
    //         rap: 1
    //     },
    //     {
    //         run: 1,
    //         fap: 1,
    //         piu: 1,
    //         gap: 1,
    //         cap: 1,
    //         go: 1,
    //         omn: 1
    //     })
    // })
    // .add('extend custom', function() {
    //     custom.extend({}, {
    //         tap: 1,
    //         fap: 1,
    //         map: 1,
    //         gap: 1,
    //         cap: 1,
    //         sap: 1,
    //         rap: 1
    //     },
    //     {
    //         run: 1,
    //         fap: 1,
    //         piu: 1,
    //         gap: 1,
    //         cap: 1,
    //         go: 1,
    //         omn: 1
    //     })
    // })
    // .add('matching1', function() {
    //     var ok = {fdgd: 111};

    //     delete ok.fdgd
    // })
    // .add('matching2', function() {
    //     var ok = {fdgd: 111};
    //     ok.fdgd = undefined;
    // })
    // .add('my clone', function() {
    //     clone(data)
    // })

    // .add('"in" check', function() {
    //     var obj = {test: ''};
    //     'test' in obj
    // })
    // .add('match check', function() {
    //     var obj = {test: ''};
    //     obj['test'] != undefined
    // })
    // add listeners
    .on('cycle', function(event) {
      console.log(String(event.target));
    })
    .on('complete', function() {
      console.log('Fastest is ' + this.filter('fastest').pluck('name'));
    })
    // run async
    .run({ 'async': true, delay: 3 });



</script>

